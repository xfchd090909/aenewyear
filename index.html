<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 宇宙纪元 | 新年快乐</title>
    <style>
        :root {
            --primary-color: #00f3ff;
            --secondary-color: #bc13fe;
            --bg-color: #000000;
        }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            overflow: hidden;
            background-color: var(--bg-color);
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            color: white;
        }

        /* 视频背景 */
        #bg-video {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            object-fit: cover;
            z-index: 0;
            filter: brightness(0.5);
        }

        #canvas-container { position: fixed; top: 0; left: 0; z-index: 2; pointer-events: none;}

        .overlay {
            position: relative; z-index: 10;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            height: 100vh; pointer-events: none;
            transition: opacity 1.5s ease;
        }

        .title-container { text-align: center; letter-spacing: 10px; }
        h1 {
            font-size: 4rem; margin: 0;
            background: linear-gradient(to bottom, #fff 20%, var(--primary-color) 80%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 20px rgba(0, 243, 255, 0.5));
        }

        #countdown { display: flex; gap: 20px; margin-top: 50px; pointer-events: auto; }
        .time-unit {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px; border-radius: 5px;
            border: 1px solid rgba(0, 243, 255, 0.3);
            min-width: 70px; text-align: center;
            backdrop-filter: blur(5px);
        }
        .time-unit span { display: block; font-size: 2rem; color: var(--primary-color); }

        #replay-btn {
            position: fixed; bottom: 50px; left: 50%; transform: translateX(-50%);
            z-index: 100; padding: 12px 30px; background: transparent;
            color: var(--primary-color); border: 1px solid var(--primary-color);
            border-radius: 20px; cursor: pointer; display: none;
            transition: all 0.3s; backdrop-filter: blur(10px); pointer-events: auto;
        }

        #replay-btn:hover { background: var(--primary-color); color: #000; box-shadow: 0 0 20px var(--primary-color); }
        #debug-tag { position: fixed; top: 10px; left: 10px; color: #ff0055; z-index: 100; font-size: 12px; display: none;}
    </style>
</head>
<body>

    <video id="bg-video" autoplay loop muted playsinline>
        <source src="video.mp4" type="video/mp4">
    </video>

    <audio id="newyear-audio">
        <source src="CHINA-2.mp3" type="audio/mpeg">
    </audio>

    <div id="debug-tag">DEBUG MODE: ON (3S DELAY)</div>
    <div id="canvas-container"></div>

    <div class="overlay" id="ui-overlay">
        <div class="title-container">
            <div id="status-text" style="color: var(--secondary-color); margin-bottom: 10px; letter-spacing: 2px;">TIMELINE SYNCHRONIZING...</div>
            <h1 id="main-title">2026 新年倒计时</h1>
        </div>
        <div id="countdown">
            <div class="time-unit"><span id="days">00</span><label>Days</label></div>
            <div class="time-unit"><span id="hours">00</span><label>Hrs</label></div>
            <div class="time-unit"><span id="minutes">00</span><label>Min</label></div>
            <div class="time-unit"><span id="seconds">00</span><label>Sec</label></div>
        </div>
    </div>

    <button id="replay-btn" onclick="handleReplay()">重新播放</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
    
    <script>
        const DEBUG_MODE = false; 
        const DEBUG_DELAY = 3000; 
        
        const messages = ["2026 新年快乐", "祝 你", "一 帆 风 顺", "二 龙 腾 飞", "三 阳 开 泰", "四 季 平 安", "五 福 临 门", "六 六 大 顺", "七 星 高 照", "八 方 来 财", "九 九 同 心", "十 全 十 美", "百 事 可 乐", "千 事 吉 祥", "万 事 如 意", "感 谢 观 看", "AE Studio 制作"];
        let currentMsgIndex = 0;
        let isNewYear = false;
        let startTime = Date.now();
        let scene, camera, renderer, stars, starGeo, starMaterial;

        function init() {
            if (DEBUG_MODE) document.getElementById('debug-tag').style.display = 'block';

            scene = new THREE.Scene();
            // 相机位置：正对着 Z 轴
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 1000);
            camera.position.set(0, 0, 250); 
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            createStarfield();
            animate();
            
            setInterval(checkTime, 1000);
            checkTime();
        }

        function createStarfield() {
            starGeo = new THREE.BufferGeometry();
            const positions = [];
            for(let i=0; i<10000; i++) {
                // 在 X-Y 平面随机分布，赋予 Z 轴深度感
                positions.push(Math.random() * 800 - 400, Math.random() * 800 - 400, Math.random() * 800 - 400);
            }
            starGeo.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));

            let sprite = new THREE.TextureLoader().load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/sprites/disc.png');
            starMaterial = new THREE.PointsMaterial({
                color: 0x00f3ff, size: 1.2, map: sprite, transparent: true, blending: THREE.AdditiveBlending, opacity: 1.0
            });

            stars = new THREE.Points(starGeo, starMaterial);
            scene.add(stars);
        }

        function checkTime() {
            if (isNewYear) return;
            const now = getBeijingTime();
            const target = new Date("2026/01/01 00:00:00");
            const diff = target - now;
            const runTime = Date.now() - startTime;

            if (DEBUG_MODE) {
                const remaining = Math.max(0, DEBUG_DELAY - runTime);
                updateCountdown(remaining);
                if (remaining <= 0) triggerNewYear();
            } else {
                if (diff <= 0) triggerNewYear();
                else updateCountdown(diff);
            }
        }

        function getBeijingTime() {
            const d = new Date();
            return new Date(d.getTime() + (d.getTimezoneOffset() * 60000) + (3600000 * 8));
        }

        function updateCountdown(diff) {
            document.getElementById("days").innerText = Math.floor(diff / 86400000).toString().padStart(2, '0');
            document.getElementById("hours").innerText = Math.floor((diff % 86400000) / 3600000).toString().padStart(2, '0');
            document.getElementById("minutes").innerText = Math.floor((diff % 3600000) / 60000).toString().padStart(2, '0');
            document.getElementById("seconds").innerText = Math.floor((diff % 60000) / 1000).toString().padStart(2, '0');
        }

        function triggerNewYear() {
            isNewYear = true;
            
            // 粒子淡出
            new TWEEN.Tween(starMaterial)
                .to({ opacity: 0 }, 1000)
                .onComplete(() => {
                    // 重置粒子到屏幕左右边缘外侧，准备“飞入”
                    const positions = starGeo.attributes.position.array;
                    for(let i=0; i<10000; i++) {
                        positions[i*3] = (Math.random() > 0.5 ? 1 : -1) * 800; 
                        positions[i*3+1] = (Math.random() - 0.5) * 500;
                        positions[i*3+2] = 0; // 文案平面 Z 轴设为 0
                    }
                    starGeo.attributes.position.needsUpdate = true;
                    starMaterial.opacity = 1;
                    
                    document.getElementById('newyear-audio').play();
                    startMessageCycle();
                })
                .start();

            document.getElementById('ui-overlay').style.opacity = '0';
            setTimeout(() => { document.getElementById('ui-overlay').style.display = 'none'; }, 1000);
        }

        function createTextMesh(text) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 1200; canvas.height = 400;
            ctx.font = 'bold 90px "Microsoft YaHei"';
            ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 2.5;
            ctx.strokeText(text, 600, 200);

            const data = ctx.getImageData(0, 0, 1200, 400).data;
            const pts = [];
            for (let y = 0; y < 400; y += 2) {
                for (let x = 0; x < 1200; x += 2) {
                    if (data[(x + y * 1200) * 4 + 3] > 120) {
                        pts.push({ x: (x - 600) * 0.6, y: (200 - y) * 0.6, z: 0 });
                    }
                }
            }
            return pts;
        }

        function startMessageCycle() {
            if (currentMsgIndex >= messages.length) {
                document.getElementById('replay-btn').style.display = 'block';
                return;
            }

            const points = createTextMesh(messages[currentMsgIndex]);
            const positions = starGeo.attributes.position.array;
            
            for (let i = 0; i < 10000; i++) {
                const target = points[i % points.length];
                new TWEEN.Tween({ 
                    x: positions[i*3], y: positions[i*3+1], z: positions[i*3+2] 
                })
                .to({ 
                    x: target.x + (Math.random()-0.5)*1.5, 
                    y: target.y + (Math.random()-0.5)*1.5, 
                    z: 0 
                }, 2200)
                .easing(TWEEN.Easing.Exponential.Out)
                .onUpdate(function(obj) {
                    positions[i*3] = obj.x;
                    positions[i*3+1] = obj.y;
                    positions[i*3+2] = obj.z;
                })
                .start();
            }

            currentMsgIndex++;
            setTimeout(startMessageCycle, 5000);
        }

        function handleReplay() {
            document.getElementById('replay-btn').style.display = 'none';
            document.getElementById('newyear-audio').currentTime = 0;
            document.getElementById('newyear-audio').play();
            currentMsgIndex = 0;
            const positions = starGeo.attributes.position.array;
            for(let i=0; i<10000; i++) { positions[i*3] = (Math.random() > 0.5 ? 1 : -1) * 800; }
            startMessageCycle();
        }

        function animate(time) {
            requestAnimationFrame(animate);
            TWEEN.update(time);

            if (!isNewYear) {
                const pos = starGeo.attributes.position.array;
                for(let i=1; i<pos.length; i+=3) {
                    pos[i] -= 0.3; // 读秒页面粒子垂直下落
                    if(pos[i] < -400) pos[i] = 400;
                }
                // 读秒页面绕 Y 轴平滑旋转
                stars.rotation.y += 0.001; 
            } else {
                // 文案阶段停止整体旋转，确保平行
                stars.rotation.y = 0;
            }
            
            starGeo.attributes.position.needsUpdate = true;
            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        init();
    </script>
</body>
</html>